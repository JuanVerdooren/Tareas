{"ast":null,"code":"import{useEffect,useState,useRef,useCallback}from\"react\";import TaskForm from\"../components/TaskForm\";import TaskList from\"../components/TaskList\";import Swal from\"sweetalert2\";import{FaSignOutAlt}from\"react-icons/fa\";import{FaUserCircle}from\"react-icons/fa\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const Dashboard=()=>{const[tasks,setTasks]=useState([]);const[username,setUsername]=useState(\"\");const[formData,setFormData]=useState({titulo:\"\",descripcion:\"\",fecha:\"\",prioridad:\"\",categoria:\"\"});const[editingTaskId,setEditingTaskId]=useState(null);const formRef=useRef(null);const token=localStorage.getItem(\"token\");const API_URL=\"http://localhost:5001/tasks\";// Cargar usuario y tareas al inicio\nconst fetchTasks=useCallback(()=>{fetch(API_URL,{headers:{Authorization:`Bearer ${token}`}}).then(res=>res.json()).then(data=>setTasks(data)).catch(err=>console.error(\"Error cargando tareas:\",err));},[token]);// Cargar usuario y tareas al inicio\nuseEffect(()=>{if(!token){window.location.href=\"/login\";return;}fetch(\"http://localhost:5001/auth/user\",{headers:{Authorization:`Bearer ${token}`}}).then(res=>res.json()).then(data=>setUsername(data.username)).catch(()=>Swal.fire(\"Error\",\"No se pudo obtener el usuario\",\"error\"));fetchTasks();},[token,fetchTasks]);// Crear o editar tarea\nconst handleSubmit=async e=>{e.preventDefault();const url=editingTaskId?`${API_URL}/${editingTaskId}`:API_URL;const method=editingTaskId?\"PUT\":\"POST\";try{const res=await fetch(url,{method,headers:{\"Content-Type\":\"application/json\",Authorization:`Bearer ${token}`},body:JSON.stringify(formData)});if(!res.ok)throw new Error(\"Error al guardar\");Swal.fire(\"Éxito\",editingTaskId?\"Tarea actualizada\":\"Tarea creada\",\"success\");setFormData({titulo:\"\",descripcion:\"\",fecha:\"\",prioridad:\"\",categoria:\"\"});setEditingTaskId(null);fetchTasks();}catch(err){Swal.fire(\"Error\",err.message,\"error\");}};// Editar tarea\nconst handleEdit=task=>{var _task$fecha;setFormData({titulo:task.titulo,descripcion:task.descripcion,fecha:(_task$fecha=task.fecha)===null||_task$fecha===void 0?void 0:_task$fecha.split(\"T\")[0],prioridad:task.prioridad,categoria:task.categoria});setEditingTaskId(task._id);if(formRef.current){formRef.current.scrollIntoView({behavior:\"smooth\"});}};// Eliminar tarea\nconst handleDelete=async id=>{const result=await Swal.fire({title:\"¿Estás seguro?\",text:\"No podrás revertir esta acción\",icon:\"warning\",showCancelButton:true,confirmButtonText:\"Sí, eliminar\",cancelButtonText:\"Cancelar\"});if(result.isConfirmed){try{await fetch(`${API_URL}/${id}`,{method:\"DELETE\",headers:{Authorization:`Bearer ${token}`}});Swal.fire(\"Eliminado\",\"La tarea ha sido eliminada.\",\"success\");fetchTasks();}catch(err){Swal.fire(\"Error\",\"No se pudo eliminar la tarea\",\"error\");}}};// Cambiar estado de la tarea\nconst toggleEstado=async(id,estadoActual)=>{try{await fetch(`${API_URL}/tasks/${id}`,{method:\"PATCH\",headers:{\"Content-Type\":\"application/json\",Authorization:`Bearer ${token}`},body:JSON.stringify({estado:!estadoActual})});fetchTasks();}catch(err){console.error(\"Error al cambiar estado:\",err);}};const handleLogout=()=>{localStorage.removeItem(\"token\");window.location.href=\"/login\";};return/*#__PURE__*/_jsxs(\"div\",{className:\"container mt-5\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex justify-content-between align-items-center mb-4\",children:[/*#__PURE__*/_jsxs(\"h4\",{className:\"d-flex align-items-center gap-2\",children:[/*#__PURE__*/_jsx(FaUserCircle,{size:30}),/*#__PURE__*/_jsxs(\"span\",{className:\"fw-semibold\",children:[\"Hola, \",username]})]}),/*#__PURE__*/_jsxs(\"button\",{className:\"btn btn-danger d-flex align-items-center gap-2 fw-bold\",onClick:handleLogout,\"data-bs-toggle\":\"tooltip\",\"data-bs-placement\":\"top\",title:\"Cerrar sesi\\xF3n\",children:[/*#__PURE__*/_jsx(FaSignOutAlt,{}),/*#__PURE__*/_jsx(\"span\",{children:\"Cerrar sesi\\xF3n\"})]})]}),/*#__PURE__*/_jsx(\"div\",{ref:formRef,children:/*#__PURE__*/_jsx(TaskForm,{formData:formData,setFormData:setFormData,handleSubmit:handleSubmit,editingTaskId:editingTaskId})}),/*#__PURE__*/_jsx(TaskList,{tasks:tasks,handleEdit:handleEdit,handleDelete:handleDelete,toggleEstado:toggleEstado})]});};export default Dashboard;","map":{"version":3,"names":["useEffect","useState","useRef","useCallback","TaskForm","TaskList","Swal","FaSignOutAlt","FaUserCircle","jsx","_jsx","jsxs","_jsxs","Dashboard","tasks","setTasks","username","setUsername","formData","setFormData","titulo","descripcion","fecha","prioridad","categoria","editingTaskId","setEditingTaskId","formRef","token","localStorage","getItem","API_URL","fetchTasks","fetch","headers","Authorization","then","res","json","data","catch","err","console","error","window","location","href","fire","handleSubmit","e","preventDefault","url","method","body","JSON","stringify","ok","Error","message","handleEdit","task","_task$fecha","split","_id","current","scrollIntoView","behavior","handleDelete","id","result","title","text","icon","showCancelButton","confirmButtonText","cancelButtonText","isConfirmed","toggleEstado","estadoActual","estado","handleLogout","removeItem","className","children","size","onClick","ref"],"sources":["/Users/margaritaolaya/Desktop/Juanky - Practica/frontend/src/pages/Dashboard.jsx"],"sourcesContent":["import { useEffect, useState, useRef, useCallback } from \"react\";\nimport TaskForm from \"../components/TaskForm\";\nimport TaskList from \"../components/TaskList\";\nimport Swal from \"sweetalert2\";\nimport { FaSignOutAlt } from \"react-icons/fa\";\nimport { FaUserCircle } from \"react-icons/fa\";\n\nconst Dashboard = () => {\n  const [tasks, setTasks] = useState([]);\n  const [username, setUsername] = useState(\"\");\n  const [formData, setFormData] = useState({\n    titulo: \"\",\n    descripcion: \"\",\n    fecha: \"\",\n    prioridad: \"\",\n    categoria: \"\",\n  });\n\n  const [editingTaskId, setEditingTaskId] = useState(null);\n  const formRef = useRef(null);\n\n  const token = localStorage.getItem(\"token\");\n  const API_URL = \"http://localhost:5001/tasks\";\n\n  // Cargar usuario y tareas al inicio\n  const fetchTasks = useCallback(() => {\n    fetch(API_URL, {\n      headers: { Authorization: `Bearer ${token}` },\n    })\n      .then((res) => res.json())\n      .then((data) => setTasks(data))\n      .catch((err) => console.error(\"Error cargando tareas:\", err));\n  }, [token]);\n\n  // Cargar usuario y tareas al inicio\n  useEffect(() => {\n    if (!token) {\n      window.location.href = \"/login\";\n      return;\n    }\n\n    fetch(\"http://localhost:5001/auth/user\", {\n      headers: { Authorization: `Bearer ${token}` },\n    })\n      .then((res) => res.json())\n      .then((data) => setUsername(data.username))\n      .catch(() =>\n        Swal.fire(\"Error\", \"No se pudo obtener el usuario\", \"error\")\n      );\n\n    fetchTasks();\n  }, [token, fetchTasks]);\n\n  // Crear o editar tarea\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n\n    const url = editingTaskId ? `${API_URL}/${editingTaskId}` : API_URL;\n    const method = editingTaskId ? \"PUT\" : \"POST\";\n\n    try {\n      const res = await fetch(url, {\n        method,\n        headers: {\n          \"Content-Type\": \"application/json\",\n          Authorization: `Bearer ${token}`,\n        },\n        body: JSON.stringify(formData),\n      });\n\n      if (!res.ok) throw new Error(\"Error al guardar\");\n\n      Swal.fire(\n        \"Éxito\",\n        editingTaskId ? \"Tarea actualizada\" : \"Tarea creada\",\n        \"success\"\n      );\n\n      setFormData({\n        titulo: \"\",\n        descripcion: \"\",\n        fecha: \"\",\n        prioridad: \"\",\n        categoria: \"\",\n      });\n      setEditingTaskId(null);\n      fetchTasks();\n    } catch (err) {\n      Swal.fire(\"Error\", err.message, \"error\");\n    }\n  };\n\n  // Editar tarea\n  const handleEdit = (task) => {\n    setFormData({\n      titulo: task.titulo,\n      descripcion: task.descripcion,\n      fecha: task.fecha?.split(\"T\")[0],\n      prioridad: task.prioridad,\n      categoria: task.categoria,\n    });\n    setEditingTaskId(task._id);\n\n    if (formRef.current) {\n      formRef.current.scrollIntoView({ behavior: \"smooth\" });\n    }\n  };\n\n  // Eliminar tarea\n  const handleDelete = async (id) => {\n    const result = await Swal.fire({\n      title: \"¿Estás seguro?\",\n      text: \"No podrás revertir esta acción\",\n      icon: \"warning\",\n      showCancelButton: true,\n      confirmButtonText: \"Sí, eliminar\",\n      cancelButtonText: \"Cancelar\",\n    });\n\n    if (result.isConfirmed) {\n      try {\n        await fetch(`${API_URL}/${id}`, {\n          method: \"DELETE\",\n          headers: { Authorization: `Bearer ${token}` },\n        });\n        Swal.fire(\"Eliminado\", \"La tarea ha sido eliminada.\", \"success\");\n        fetchTasks();\n      } catch (err) {\n        Swal.fire(\"Error\", \"No se pudo eliminar la tarea\", \"error\");\n      }\n    }\n  };\n\n  // Cambiar estado de la tarea\n  const toggleEstado = async (id, estadoActual) => {\n    try {\n      await fetch(`${API_URL}/tasks/${id}`, {\n        method: \"PATCH\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          Authorization: `Bearer ${token}`,\n        },\n        body: JSON.stringify({ estado: !estadoActual }),\n      });\n      fetchTasks();\n    } catch (err) {\n      console.error(\"Error al cambiar estado:\", err);\n    }\n  };\n\n  const handleLogout = () => {\n    localStorage.removeItem(\"token\");\n    window.location.href = \"/login\";\n  };\n\n  return (\n    <div className=\"container mt-5\">\n      <div className=\"d-flex justify-content-between align-items-center mb-4\">\n        <h4 className=\"d-flex align-items-center gap-2\">\n          <FaUserCircle size={30}/>\n          <span className=\"fw-semibold\">Hola, {username}</span>\n        </h4>\n\n        <button\n          className=\"btn btn-danger d-flex align-items-center gap-2 fw-bold\"\n          onClick={handleLogout}\n          data-bs-toggle=\"tooltip\"\n          data-bs-placement=\"top\"\n          title=\"Cerrar sesión\"\n        >\n          <FaSignOutAlt />\n          <span>Cerrar sesión</span>\n        </button>\n      </div>\n\n      <div ref={formRef}>\n        <TaskForm\n          formData={formData}\n          setFormData={setFormData}\n          handleSubmit={handleSubmit}\n          editingTaskId={editingTaskId}\n        />\n      </div>\n\n      <TaskList\n        tasks={tasks}\n        handleEdit={handleEdit}\n        handleDelete={handleDelete}\n        toggleEstado={toggleEstado}\n      />\n    </div>\n  );\n};\n\nexport default Dashboard;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}